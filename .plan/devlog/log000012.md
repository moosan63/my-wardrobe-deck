# Dev Log 000012: Phase 5 - SSRページ移行

## 対象フェーズ
Phase 5: SSRページ移行

## 実施日
2026-01-20

## 実施内容の要約

### 変更ファイル

| ファイル | 変更内容 |
|---------|----------|
| `app/routes/index.tsx` | ListItemsユースケースに移行 |
| `app/routes/items/new.tsx` | CreateItemユースケースに移行 |
| `app/routes/items/[id]/index.tsx` | GetItemユースケースに移行 |
| `app/routes/items/[id]/edit.tsx` | GetItem, UpdateItemユースケースに移行 |
| `app/routes/items/[id]/delete.tsx` | DeleteItemユースケースに移行 |

### テスト・ビルド結果
- ビルド成功（client + SSR）
- 162テスト全パス

## 技術的判断・理由

### 1. リポジトリのインスタンス化
- 各loader/action関数内でリポジトリとユースケースをインスタンス化
- HonoXのリクエストコンテキスト（`c.env.DB`）を適切に渡すため

### 2. エラーハンドリング変換
- `mapCreateItemErrorToFormErrors()` / `mapUpdateItemErrorToFormErrors()` 関数を追加
- Result型のエラーをフォーム用エラー形式（FormErrors）に変換
- エラータイプに応じて適切なフィールドにエラーメッセージを割り当て

### 3. 型変換（互換性維持）
- `toFormItem()` 変換関数: `ItemReadModel` → 既存の`Item`型形式
- `createdAt` → `created_at` 形式に変換
- ItemFormコンポーネントとの互換性を維持

### 4. エラー時の画面遷移
- INVALID_ITEM_ID: 無効なID画面を表示
- ITEM_NOT_FOUND: アイテムが見つからない画面を表示
- DATABASE_ERROR: フォームエラーとして表示

## レビュー内容と対応

### 必須指摘（軽微）
| 指摘 | 状態 |
|------|------|
| edit.tsxの型キャスト | 実害なし（ユースケース層でバリデーション済み） |

### 推奨指摘（Phase 6で対応）
| 指摘 | 対応方針 |
|------|----------|
| new.tsxのJSX重複削減 | Phase 6で検討 |
| エラーメッセージ変換の共通化 | Phase 6で検討 |
| delete.tsxのエラー表示改善 | Phase 6で検討 |
| リポジトリインスタンス化の共通化 | Phase 6で検討 |

### 任意指摘
- 詳細ページのヘルパー関数の配置（color-utils）
- CSRF対策の確認

## 問題点・反省
- 特になし。スムーズに移行完了

## 次フェーズへの申し送り
- **Phase 6: クリーンアップ**へ進む
- `app/db/items.ts` の削除（もはや参照されていない）
- `app/types/item.ts` の削除/修正（ItemFormの型定義更新）
- 不要なインポートの削除
- README.mdの更新
- レビュー推奨事項の対応検討
