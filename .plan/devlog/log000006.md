# Dev Log 000006 - ルーティング構成リファクタリング

## 対象タスク
ルーティングパターンの統一（`new Hono()` → `createRoute` パターン）

## 実施内容の要約

### Phase 1: ルーティングパターンの変換

**変更ファイル:**
1. `app/routes/items/new.tsx`
   - `import { Hono } from 'hono'` → `import { createRoute } from 'honox/factory'`
   - `app.get('/')` → `export default createRoute(...)`
   - `app.post('/')` → `export const POST = createRoute(...)`

2. `app/routes/api/items/index.ts`
   - `app.get('/')` → `export const GET = createRoute(...)`
   - `app.post('/')` → `export const POST = createRoute(...)`

3. `app/routes/api/items/[id].ts`
   - `app.get('/')` → `export const GET = createRoute(...)`
   - `app.put('/')` → `export const PUT = createRoute(...)`
   - `app.delete('/')` → `export const DELETE = createRoute(...)`

### Phase 2: ハンドラーロジックの分離（テスト対応）

参考リポジトリと同じ構成に変更:

**新規作成:**
- `app/lib/items-handlers.ts` - APIハンドラーロジックを分離

**更新:**
- `app/routes/api/items/index.ts` - ハンドラーをインポートして使用
- `app/routes/api/items/[id].ts` - ハンドラーをインポートして使用
- `tests/api/items.test.ts` - ハンドラーを直接インポートしてテスト
- `vitest.config.ts` - `wrangler.json` を参照するよう修正

## 技術的判断・理由

- 参考リポジトリ（my_manga_update_notifier）と同じパターンに統一
- HonoXのファイルベースルーティングに適した `createRoute` パターンを採用
- `createRoute` はファイルベースルーティング専用のため、テスト時は直接ハンドラー関数を使う必要がある
- ハンドラーロジックを `app/lib/items-handlers.ts` に分離することでテスト可能に

## 問題点・解決

1. **`createRoute` の戻り値がテストで直接使えない**
   - 原因: `createRoute` はHonoXのファイルベースルーティング用のラッパーを返す
   - 解決: ハンドラーロジックを分離し、テストでは直接ハンドラー関数をインポート

2. **`vitest.config.ts` が `wrangler.toml` を参照していた**
   - 解決: `wrangler.json` を参照するよう修正

## 確認結果

- ビルド: 成功
- テスト: 40件すべて成功
- 動作確認:
  - GET / (ホームページ): OK
  - GET /items/new: OK
  - GET /items/:id: OK
  - GET /items/:id/edit: OK
  - GET /api/items: OK
  - GET /api/items/:id: OK
